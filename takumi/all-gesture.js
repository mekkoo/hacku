//ピザ・すし・ナマステ起動
//作成者: 須田
//日付: 2013年11月23日(土)
//参考:
//スマートちゃんぷる: LeapTrainer.jsを使ってみる
//http://smartchamploo.blogspot.jp/2013/09/leaptrainerjs.html


//ループ外で変数を用意
var pizzaCnt = "";
var sushiCnt = "";
var namasuteCnt = "";

//ピザ注文関数
function pizzaAct() {
	console.log('pizzaAct!');
}

function sushiAct() {
	console.log('namasuteeeeeeeeeAct!!!!');
}

function namasuteAnt() {
	console.log('sushiAct......');
}

var controller = new Leap.Controller({enableGestures: true});
//create a LeapTrainer controller object
var trainer = new LeapTrainer.Controller({controller: controller});
// trainer.fromJSON('{"name":"NAMASUTE","pose":false,"data":[[{"x":0.4454638857849339,"y":-0.07073768692041396,"z":0.16706227388647343,"stroke":1},{"x":0.16141359189388693,"y":0.1282883935199512,"z":-0.3585075644771397,"stroke":1},{"x":-0.5545361142150661,"y":-0.04621326647368436,"z":0.12200601519683518,"stroke":1},{"x":0.12535587428286354,"y":-0.07076414646408213,"z":0.17730933219393485,"stroke":1},{"x":0.31991086227993726,"y":0.12880112916675246,"z":-0.3660447865364427,"stroke":1},{"x":-0.32089013813342027,"y":0.006517559117547103,"z":-0.0200936961365335,"stroke":1},{"x":-0.10835212499679281,"y":-0.07003367047863825,"z":0.1868490601767272,"stroke":1},{"x":0.33117297414326463,"y":0.0583901276304649,"z":-0.16792160985402751,"stroke":1},{"x":-0.16208273079809016,"y":0.04506849405543788,"z":-0.11852706279093048,"stroke":1},{"x":-0.23695627418361753,"y":-0.06794662085757502,"z":0.19795870124973836,"stroke":1},{"x":0.3102275504700579,"y":0.030454829881583725,"z":-0.07536453086756828,"stroke":1},{"x":-0.10309547595222429,"y":0.060739530601779404,"z":-0.14894807477251934,"stroke":1},{"x":-0.23396618410196185,"y":-0.06551386211775365,"z":0.21067526103933498,"stroke":1},{"x":0.2697340191737425,"y":0.050329275116181446,"z":-0.10240518717736224,"stroke":1},{"x":-0.243399715647513,"y":-0.11738008577755064,"z":0.2959518688694801,"stroke":1}]]}');
// trainer.fromJSON('{"name":"SUSHI","pose":false,"data":[[{"x":0.47908447620325223,"y":0.08973994969388302,"z":0.5292734251501678,"stroke":1},{"x":-0.39382182390627674,"y":-0.20159140346599982,"z":-0.1998792022636448,"stroke":1},{"x":0.26664489525430046,"y":0.07251333740909463,"z":0.2890840907667919,"stroke":1},{"x":-0.11183434507716183,"y":-0.07963499463044449,"z":0.0044560863660159655,"stroke":1},{"x":0.009201450119828758,"y":-0.011349402054519064,"z":0.02535131738135815,"stroke":1},{"x":0.18720145835657587,"y":0.0669443118076625,"z":0.13547837845955968,"stroke":1},{"x":-0.2664741899371097,"y":-0.117797453229158,"z":-0.17602597884270335,"stroke":1},{"x":0.45821473943143254,"y":0.2459686549250296,"z":0.17770115218371152,"stroke":1},{"x":-0.5046599525192108,"y":-0.23552672058392357,"z":-0.2908470856038062,"stroke":1},{"x":0.45234707620363024,"y":0.3042416783027051,"z":0.06463468499435926,"stroke":1},{"x":-0.21507554597929374,"y":-0.07013374073068218,"z":-0.18234913586425355,"stroke":1},{"x":0.16008728564677877,"y":0.17069065656456586,"z":-0.09550486990859738,"stroke":1},{"x":-0.5209155237967478,"y":-0.2340648740082141,"z":-0.2813728628189591,"stroke":1}]]}');

trainer.fromJSON('{"name":"NAMASUTE","pose":false,"data":[[{"x":0.5699416877968746,"y":0.0213031681374804,"z":-0.0293510006332926,"stroke":1},{"x":0.5172487288568142,"y":0.010863176858466495,"z":-0.005157445674911554,"stroke":1},{"x":0.5164683180462588,"y":0.05467677979698787,"z":-0.1218560062815737,"stroke":1},{"x":0.08991031613968309,"y":-0.030056231122225996,"z":0.001493253481188478,"stroke":1},{"x":-0.12932908013197408,"y":-0.012917407932559466,"z":-0.01455852494754492,"stroke":1},{"x":-0.15628976165624242,"y":-0.3119994257156396,"z":-0.07681861436423877,"stroke":1},{"x":-0.3493874168641514,"y":0.0045945447941342366,"z":-0.035208226687267474,"stroke":1},{"x":-0.43005831220312546,"y":0.16967394957919762,"z":-0.16894392392918797,"stroke":1},{"x":-0.039276371802985155,"y":-0.01490872766080975,"z":-0.015086155038628923,"stroke":1},{"x":0.22796160162016338,"y":-0.03260608649035007,"z":0.010434835884193722,"stroke":1},{"x":0.11585745268213204,"y":-0.025481828530625972,"z":0.0031542796919845906,"stroke":1},{"x":-0.3707444835857429,"y":0.1813567823479102,"z":0.03576538425663206,"stroke":1},{"x":-0.20977394101000235,"y":-0.008243740266884958,"z":-0.03162998911761106,"stroke":1},{"x":0.22770893225111494,"y":-0.042093404943954416,"z":0.028521511646558834,"stroke":1},{"x":-0.2331072557616063,"y":0.043529770719785976,"z":0.03072640564139842,"stroke":1},{"x":0.14552832351780903,"y":-0.019668933612298323,"z":0.010592732556772955,"stroke":1},{"x":-0.2672608566505703,"y":0.005822889818604293,"z":-0.013043105505893049,"stroke":1},{"x":-0.03435552110006612,"y":0.10439659469794016,"z":0.03492454755954702,"stroke":1},{"x":0.025362766761591105,"y":0.1238802442831839,"z":0.03751587181564625,"stroke":1},{"x":-0.10066357587322178,"y":0.05442230957703165,"z":0.046395209426202816,"stroke":1},{"x":-0.06663273004502135,"y":-0.015671782053122696,"z":0.05634337682204546,"stroke":1},{"x":-0.06532940544757193,"y":-0.10835561509407754,"z":0.1127965751299885,"stroke":1},{"x":0.016220584459840648,"y":-0.1525170271881737,"z":0.10298900826799093,"stroke":1}]]}');
trainer.fromJSON('{"name":"SUSHI","pose":false,"data":[[{"x":-0.5912653261820099,"y":-0.00990425187708631,"z":-0.10075240256716422,"stroke":1},{"x":-0.10997835473812928,"y":0.016587466441219292,"z":-0.000371443488907261,"stroke":1},{"x":0.3713086167057513,"y":0.04307918475952488,"z":0.1000095155893497,"stroke":1},{"x":0.34481663209771374,"y":0.04161786365015632,"z":0.09452685941363123,"stroke":1},{"x":-0.13648616204848402,"y":0.015119379539781624,"z":-0.00577641896481991,"stroke":1},{"x":-0.563572480170107,"y":-0.009542404287044073,"z":-0.09610676402149547,"stroke":1},{"x":-0.07741890317605848,"y":-0.003266213215854366,"z":-0.018449787721361813,"stroke":1},{"x":0.4087346738179901,"y":0.0030099778553353412,"z":0.05920718857877191,"stroke":1},{"x":0.07154630594655476,"y":-0.0013332374636785133,"z":0.005472017165324666,"stroke":1},{"x":0.2823149977467787,"y":-0.09536776540235423,"z":-0.037758763983328794,"stroke":1}]]}');

controller.loop(function(frame){
	//ジェスチャーにまつわる情報を格納する変数
	var gestureString = "";

	if (frame.gestures.length > 0) {
		for (var i = 0; i < frame.gestures.length; i++) {
			var gesture = frame.gestures[i];
			gestureString += "Gesture ID: " + gesture.id + ", "
					+ "type: " + gesture.type + ", "
					+ "state: " + gesture.state + ", "
					+ "hand IDs: " + gesture.handIds.join(", ") + ", "
					+ "pointable IDs: " + gesture.pointableIds.join(", ") + ", "
					+ "duration: " + gesture.duration + " &micro;s, ";

			switch (gesture.type) {
				case "circle":
						//pizzaCntにインクリメント
						pizzaCnt++;
						gestureString += "pizzaCnt:" + pizzaCnt;
						//100回ごとにpizzaAct関数を起動
						if (pizzaCnt % 100 === 0) pizzaAct();
						console.log(gestureString);
					break;
				default:
					gestureString += "unkown gesture type";
			}
			// console.log(gestureString);
		}
	}

	trainer.on('SUSHI', function() {
		if (frame.hands.length == 2 && frame.fingers.length <= 2) { 
			if (sushiCnt % 2000 === 0) {
				sushiAct();
			}else {
				sushiCnt++;
			}
		}
	});
	trainer.on('NAMASUTE', function() {
		if (frame.hands.length <= 1 && frame.fingers.length <= 2) {
			if (namasuteCnt % 2000 === 0) {
				namasuteAnt();
			}else {
				namasuteCnt++;
			}
		}
	});

});